# Progress

## Completed Tasks
- Wire up /tasks command and view routing: Added 'tasks' to ActiveView type, SlashCommand type, VALID_COMMANDS array, handled the command in useSlashCommands.ts to set active view, and added TasksView routing in ViewRouter.tsx. The /tasks command now opens the TasksView component.
- Add toggle done functionality to TasksView: Implemented 'd' key handler in TasksView that calls toggleTaskDone from prd.ts, saves the updated PRD, refreshes the local state, and displays a success message. Users can now mark tasks as done or undone directly from the TasksView using the 'd' key.
- Add delete task functionality with confirmation: Added a ViewMode type with 'list' and 'confirm-delete' modes to TasksView. Users can press 'x' to enter delete confirmation mode, which shows a red-bordered prompt with the task title and options to confirm (Enter) or cancel (Escape). After deletion, the selected index is adjusted to stay within bounds. The help text was updated to show the new 'x Delete' keyboard shortcut.
- Gracefully handle non-git repositories: Added isGitRepository() utility function in src/lib/paths.ts to check for .git directory existence. Updated appStore.ts to track isInGitRepository state during project validation (non-blocking). Modified buildPrompt() in src/lib/prompt.ts to conditionally include commit instructions based on git availability. Updated dry-run validation in useDryRun.ts to warn when not in a git repository. Added tests for the new isGitRepository() function.
- Create project registry types and resolution logic: Created src/lib/services/project-registry/types.ts with ProjectIdType ('git' | 'path' | 'custom'), ProjectIdentifier, ProjectMetadata, and ProjectRegistry interfaces. Created src/lib/services/project-registry/resolution.ts with pure functions: normalizeGitRemote (strips protocols and .git suffix, converts SSH format), hashPath (creates 12-char SHA-256 hash), sanitizeFolderName (replaces invalid chars with dashes), buildFolderName (creates prefixed folder name), and helper functions createProjectIdentifier, createGitProjectIdentifier, createPathProjectIdentifier. Created src/lib/services/project-registry/git.ts with getGitRemoteUrl function that runs 'git remote get-url origin'. Added comprehensive unit tests covering edge cases for SSH vs HTTPS URLs and special characters.
- Implement ProjectRegistryService: Created src/lib/services/project-registry/implementation.ts with createProjectRegistryService() factory function that manages the global project registry at ~/.ralph/registry.json and project data folders at ~/.ralph/projects/<folder-name>/. Implemented loadRegistry() and saveRegistry() for reading/writing the registry JSON. Implemented ensureProjectsDir() to create the projects directory. Implemented resolveCurrentProject() that checks pathCache first, then tries git remote detection, then path hash, returning ProjectIdentifier or null. Implemented registerProject() that determines identifier, creates project folder, updates registry and pathCache. Implemented getProjectDir() and getProjectFilePath() for path resolution. Added listProjects(), getProjectMetadata(), updateLastAccessed(), isProjectInitialized(), and removeProject() utility functions. Added ProjectRegistryService interface and RegisterProjectOptions type to types.ts. Created src/lib/services/project-registry/index.ts that exports all public types and the factory function. Added comprehensive unit tests in src/__tests__/lib/project-registry/implementation.test.ts using temp directories (34 tests covering all service methods).
- Integrate ProjectRegistryService into service container: Added 'projectRegistry: ProjectRegistryService' to ServiceContainer interface in src/lib/services/container.ts. Added getProjectRegistryService() accessor function following the existing service accessor pattern. Updated bootstrapServices() in src/lib/services/bootstrap.ts to create projectRegistry first via createProjectRegistryService(). Added createMockProjectRegistryService() with sensible test defaults (resolveCurrentProject returns a test path identifier, getProjectDir returns a temp path). Updated bootstrapTestServices() to include the mock projectRegistry. Exported ProjectRegistryService type, ProjectRegistryConfig type, and getProjectRegistryService from src/lib/services/index.ts. Refactored createProjectRegistryService() to accept optional ProjectRegistryConfig for dependency injection, enabling proper test isolation with temp directories. Updated implementation tests to use the config-based approach for proper test isolation.
