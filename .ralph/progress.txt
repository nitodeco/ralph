Task 1: Add retry logic and error recovery for agent failures - COMPLETED

Implementation:
- Added maxRetries and retryDelayMs to RalphConfig type in src/types.ts
- Implemented exponential backoff retry logic in useAgent hook with calculateRetryDelay function
- Added error categorization with FATAL_ERROR_PATTERNS to determine retryable vs fatal errors
- Updated RunApp to pass retryCount and isRetrying props to AgentOutput
- Added configuration options in SetupWizard for max_retries and retry_delay steps
- Display retry configuration in setup completion summary

Task 2: Implement session persistence and resume capability - COMPLETED

Implementation:
- Session types (Session, SessionStatus) already existed in src/types.ts with iteration count, start time, current task index
- Core session functions (loadSession, saveSession, deleteSession, createSession, updateSessionIteration, updateSessionStatus, isSessionResumable) already existed in lib/session.ts
- Auto-save on iteration completion was already implemented in RunApp's onIterationComplete callback
- Added resume prompt UI in RunApp showing session info when a resumable session is detected
- Added /resume slash command handler in RunApp to resume interrupted sessions
- Added autoResume prop to RunApp to support automatic resume from CLI
- Added "ralph resume" CLI command to index.tsx that auto-resumes existing sessions
- Updated HelpView with /resume command and resume CLI command documentation
- Updated printHelp() with resume command documentation

Task 3: Add comprehensive logging system - COMPLETED

Implementation:
- Created src/lib/logger.ts with Logger class supporting log levels (debug, info, warn, error)
- Implemented log rotation with configurable max file size (default 5MB) and backup count (default 3)
- Added logFilePath configuration option to RalphConfig in src/types.ts
- Logs are written to .ralph/ralph.log by default
- Integrated logging in useAgent hook for agent executions, outputs, exit codes, errors, and retries
- Integrated logging in RunApp for iteration starts, completions, session starts, resumes, and max iterations
- Each log entry includes ISO timestamp, log level, message, and optional context
- Added helper functions: getLogger, createLogger, readLogFile, getRecentLogEntries

Task 4: Implement agent timeout and watchdog functionality - COMPLETED

Implementation:
- Added agentTimeoutMs and stuckThresholdMs configuration options to RalphConfig in src/types.ts
- Default timeout is 30 minutes (DEFAULT_AGENT_TIMEOUT_MS = 30 * 60 * 1000)
- Default stuck threshold is 5 minutes (DEFAULT_STUCK_THRESHOLD_MS = 5 * 60 * 1000)
- Implemented timeout wrapper in useAgent that kills agent process if it exceeds agentTimeoutMs
- Added heartbeat detection that monitors stdout/stderr activity
- Agent is killed and retried if no output for stuckThresholdMs duration
- Stuck check runs at intervals of min(stuckThresholdMs/4, 30 seconds)
- Both timeout and stuck errors are treated as retryable errors
- Setting timeout or stuck threshold to 0 disables that feature
- Added SetupWizard steps for configuring agent timeout and stuck threshold
- Display timeout and stuck threshold settings in setup completion summary

Task 5: Add notification system for completion and failures - COMPLETED

Implementation:
- Added NotificationConfig interface with systemNotification, webhookUrl, and markerFilePath options in src/types.ts
- Added NotificationEvent type for 'complete', 'max_iterations', and 'fatal_error' events
- Created src/lib/notifications.ts with notification functions:
  - sendSystemNotification: Uses osascript to send macOS system notifications
  - sendWebhookNotification: Sends HTTP POST request with JSON payload to configured webhook URL
  - writeMarkerFile: Writes JSON marker file with event details for script integration
  - sendNotifications: Orchestrates all configured notification methods
- Added notification configuration steps to SetupWizard:
  - System notification enable/disable option
  - Webhook URL text input (optional)
  - Marker file path text input (optional)
  - Display notification settings in setup completion summary
- Integrated notifications into RunApp:
  - Send 'complete' notification when all tasks are finished
  - Send 'max_iterations' notification when iteration limit is reached
  - Send 'fatal_error' notification when an unrecoverable error occurs

Task 6: Implement background/daemon mode - COMPLETED

Implementation:
- Created src/lib/daemon.ts with daemon management functions:
  - writePidFile: Writes process ID to .ralph/ralph.pid
  - readPidFile: Reads PID from file
  - deletePidFile: Removes PID file
  - isProcessRunning: Checks if process with given PID is running
  - isBackgroundProcessRunning: Checks if Ralph daemon is currently running
  - spawnDaemonProcess: Spawns detached child process with output redirected to log file
  - isDaemonProcess: Checks if current process is a daemon child
  - cleanupDaemon: Cleans up PID file on exit
- Updated src/index.tsx:
  - Added --background and -b flags to CLI argument parser
  - Added handleBackgroundMode function to spawn daemon and display status
  - Added signal handlers (SIGTERM, SIGINT) for graceful daemon shutdown
  - Daemon child writes own PID and cleans up on exit
  - Added autoStart prop to RunWithSetup for daemon auto-start
- Updated src/components/RunApp.tsx:
  - Added autoStart prop to automatically begin iterations in daemon mode
  - Added useEffect to trigger auto-start when running as daemon
- Updated help text with background mode documentation and examples

Task 7: Add 'ralph status' command - COMPLETED

Implementation:
- Added "status" to the Command type in src/index.tsx
- Created printStatus function that displays:
  - Process status (running with PID or not running)
  - Session information (status, start time, last update, elapsed time, iteration count)
  - Project progress (project name, tasks completed, percentage, current/next task)
  - Recent log entries (last 10 entries from ralph.log)
- Added formatElapsedTime helper function for human-readable time display
- Handles case where no session exists gracefully
- Handles case where session was interrupted (not running but status is "running")
- Added "status" command case to CLI switch statement
- Updated help text with status command documentation and examples

Task 8: Add 'ralph stop' command for graceful shutdown - COMPLETED

Implementation:
- Added "stop" to the Command type in src/index.tsx
- Created StopResult interface in src/lib/daemon.ts with success, pid, message, and wasKilled fields
- Implemented stopDaemonProcess function in src/lib/daemon.ts:
  - Reads PID from .ralph/ralph.pid using isBackgroundProcessRunning
  - Sends SIGTERM signal for graceful shutdown
  - Polls process status with configurable timeout (default 5 seconds)
  - Falls back to SIGKILL if process doesn't exit within timeout
  - Returns detailed result with success status and whether force kill was required
- Created handleStopCommand function in src/index.tsx:
  - Updates session status to "stopped" before stopping process
  - Handles case where no process is running but session was marked as running
  - Displays appropriate messages for graceful stop, force kill, and errors
- Added "stop" case to CLI switch statement
- Updated help text with stop command documentation and examples
- Exported stopDaemonProcess from daemon.ts for use in index.tsx

Task 8: Add 'ralph stop' command for graceful shutdown - COMPLETED

Implementation:
- Added stopDaemonProcess function to src/lib/daemon.ts:
  - Reads PID from .ralph/ralph.pid
  - Sends SIGTERM for graceful shutdown
  - Waits for process to exit with configurable timeout (default 5000ms)
  - Falls back to SIGKILL if process doesn't exit gracefully
  - Cleans up PID file after process termination
  - Returns StopResult with success status, message, and PID
- Added handleStopCommand async function to src/index.tsx:
  - Calls stopDaemonProcess to terminate the background process
  - Updates session.json status to "stopped" for resumability
  - Displays appropriate messages based on stop result
  - Suggests using 'ralph resume' to continue later
- Added "stop" case to CLI switch statement
- Help text already includes stop command documentation

Task 9: Add 'ralph list' command to display PRD tasks - COMPLETED

Implementation:
- Added "list" to the Command type in src/index.tsx
- Added --json flag parsing to parseArgs function
- Created TaskListOutput interface for JSON output structure
- Implemented printList function with:
  - PRD loading with error handling for missing files
  - Human-readable output with status indicators (✓ for done, ○ for pending)
  - Dimmed styling for completed tasks
  - Completion percentage and task count summary
  - Display of next pending task
  - JSON output mode with full task details (title, description, status, steps)
- Added "list" case to CLI switch statement
- Updated help text with list command documentation and examples

Task 10: Implement progress file improvements - COMPLETED

Implementation:
- Created src/lib/progress.ts with structured progress tracking:
  - ProgressEntry type with timestamp, type, iteration, totalIterations, message, and optional context
  - SessionSummary type with project info, timing, iteration/task counts, and status
  - Multiple entry types: session_start, session_resume, iteration_start, iteration_complete, task_complete, error, retry, session_complete, session_stopped, max_iterations
- Added timestamp to each progress entry using ISO format
- Included iteration number with each update (e.g., [Iteration 3/10])
- Implemented session summary section at top of progress.txt:
  - Project name, start time, last update time
  - Status (Running, Completed, Stopped, Max Iterations Reached)
  - Iteration progress (X / Y)
  - Task progress (X / Y)
- Implemented progress file rotation to prevent unbounded growth:
  - Default max file size: 1MB
  - Default max backup files: 2
  - Files rotated to progress.txt.1, progress.txt.2
- Integrated logging for errors and retries in progress file:
  - Error entries include context (exitCode, fatal flag, etc.)
  - Retry entries include retry count, max retries, delay, and reason
- Updated src/stores/appStore.ts to call progress functions on:
  - Session start/resume
  - Iteration start/complete
  - Session complete/stopped/max iterations
  - Fatal errors
- Updated src/stores/agentStore.ts to log errors and retries to progress file
- Updated src/lib/prd.ts to remove PROGRESS_FILE_PATH (now in progress.ts)
- Updated src/components/InitWizard.tsx to import PROGRESS_FILE_PATH from progress.ts

Task 11: Add memory and resource management - COMPLETED

Implementation:
- Added MemoryConfig interface to src/types.ts with configurable options:
  - maxOutputBufferBytes: Maximum size for agent output buffer (default 5MB)
  - memoryWarningThresholdMb: Threshold for memory warnings (default 500MB)
  - enableGarbageCollectionHints: Enable/disable GC hints between iterations (default true)
- Created src/lib/memory.ts with memory management utilities:
  - getMemoryUsage: Returns current memory usage stats (heapUsed, heapTotal, rss, external in MB)
  - checkMemoryWarning: Monitors memory and logs warnings when heap exceeds threshold
  - suggestGarbageCollection: Hints to GC when available (globalThis.gc)
  - truncateOutputBuffer: Limits output buffer size, preserving 30% start and 70% end with truncation notice
  - cleanupTempFiles: Removes temporary files (.tmp, .temp, ~) from .ralph directory
  - performIterationCleanup: Orchestrates cleanup between iterations (temp files, GC, memory check)
- Updated src/stores/agentStore.ts:
  - Added clearOutput action to explicitly clear output buffer between iterations
  - Updated setOutput to automatically truncate output when it exceeds maxOutputBufferBytes
- Updated src/stores/appStore.ts:
  - Integrated performIterationCleanup in onIterationComplete callback
  - Clear agent output buffer after each iteration completes
- Added memory configuration steps to SetupWizard:
  - Output buffer size selection (1MB to 50MB)
  - Memory warning threshold selection (250MB to 2GB, or disabled)
  - GC hints enable/disable toggle
  - Display memory settings in setup completion summary

Task 12: Implement task dependency and ordering - COMPLETED

Implementation:
- Added optional 'dependsOn' field to PrdTask type in src/types.ts (already present)
- Implemented dependency resolution in getNextTask in src/lib/prd.ts:
  - areDependenciesSatisfied: Checks if all task dependencies are marked as done
  - getNextTask: Now only returns tasks with satisfied dependencies
  - getTaskDependencies: Gets the dependency tasks for a task
  - getTaskDependents: Gets the tasks that depend on a given task
- Implemented circular dependency validation in validateDependencies in src/lib/prd.ts:
  - Validates all dependency references point to existing tasks
  - Uses DFS with recursion stack to detect circular dependencies
  - Returns detailed error message with circular path when detected
  - Validation runs on PRD load by default (can be skipped with flag)
- Updated prompts in src/lib/prompt.ts to support dependency specification:
  - buildPrdGenerationPrompt: Example shows dependsOn usage and instructions
  - buildAddTaskPrompt: Format example includes dependsOn field
- Updated printList in src/index.tsx to display dependency tree:
  - TaskListOutput interface includes dependsOn and blockedBy fields
  - Added "blocked" status for tasks with unmet dependencies
  - Display blocked tasks with ⊘ icon and yellow color
  - Show dependency chain under each task with ✓/○ icons for status
  - Summary shows completed, ready, and blocked counts
  - Next task only shows tasks that are not blocked
