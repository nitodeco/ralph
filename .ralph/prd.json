{
	"project": "Ralph CLI",
	"tasks": [
		{
			"title": "Create service container and bootstrap infrastructure",
			"description": "Create the core service container and bootstrap infrastructure that all services will use. This establishes the dependency injection pattern for the entire application.\n\nARCHITECTURE RULES:\n- Services are defined as interfaces in types.ts within each service directory\n- Implementations are factory functions (createXxxService) that return the interface\n- NO index.ts barrel files inside service directories to avoid circular imports\n- Container imports types from ./servicename/types.ts and implementations from ./servicename/implementation.ts\n- Top-level src/lib/services/index.ts is the ONLY barrel file, explicitly listing all exports\n- Each service directory is self-contained with: types.ts, implementation.ts, validation.ts (if needed), and any service-specific helpers",
			"steps": [
				"Create src/lib/services/container.ts with ServiceContainer interface, initializeServices(), getServices(), resetServices(), isInitialized(), and convenience accessors (getConfigService, getPrdService, etc.)",
				"Create src/lib/services/bootstrap.ts with bootstrapServices() and bootstrapTestServices(overrides) functions",
				"Update src/lib/services/index.ts to export container and bootstrap functions, plus type re-exports from each service's types.ts",
				"Update src/index.tsx to call bootstrapServices() before application startup"
			],
			"done": true
		},
		{
			"title": "Migrate SessionMemoryService to new architecture",
			"description": "Migrate the session-memory module to the new self-contained service architecture.\n\nARCHITECTURE RULES:\n- Services are defined as interfaces in types.ts within each service directory\n- Implementations are factory functions (createXxxService) that return the interface\n- NO index.ts barrel files inside service directories to avoid circular imports\n- Container imports types from ./servicename/types.ts and implementations from ./servicename/implementation.ts\n- Top-level src/lib/services/index.ts is the ONLY barrel file, explicitly listing all exports\n- Each service directory is self-contained with: types.ts, implementation.ts, validation.ts (if needed), and any service-specific helpers\n- Move SessionMemory type from src/types/session.types.ts to the service's types.ts\n- Move isSessionMemory from src/lib/type-guards.ts to the service's validation.ts\n- Implementation uses closure-based caching (let cachedMemory inside factory function)",
			"steps": [
				"Create src/lib/services/session-memory/types.ts with SessionMemory interface, SessionMemoryStats interface, SessionMemoryService interface, and SESSION_MEMORY_CONSTANTS",
				"Create src/lib/services/session-memory/validation.ts with isSessionMemory type guard",
				"Create src/lib/services/session-memory/formatters.ts with formatForPrompt, formatForTask, and exportAsMarkdown functions",
				"Create src/lib/services/session-memory/implementation.ts with createSessionMemoryService factory function",
				"Update src/lib/services/container.ts to import SessionMemoryService from ./session-memory/types.ts",
				"Update src/lib/services/bootstrap.ts to import createSessionMemoryService from ./session-memory/implementation.ts",
				"Update src/lib/services/index.ts to re-export SessionMemory and SessionMemoryService types",
				"Update all consumers to use getSessionMemoryService() instead of direct imports from src/lib/session-memory.ts",
				"Remove SessionMemory from src/types/session.types.ts and isSessionMemory from src/lib/type-guards.ts",
				"Delete src/lib/session-memory.ts after all consumers are migrated"
			],
			"done": true
		},
		{
			"title": "Migrate SessionService to new architecture",
			"description": "Migrate the session module to the new self-contained service architecture.\n\nARCHITECTURE RULES:\n- Services are defined as interfaces in types.ts within each service directory\n- Implementations are factory functions (createXxxService) that return the interface\n- NO index.ts barrel files inside service directories to avoid circular imports\n- Container imports types from ./servicename/types.ts and implementations from ./servicename/implementation.ts\n- Top-level src/lib/services/index.ts is the ONLY barrel file, explicitly listing all exports\n- Each service directory is self-contained with: types.ts, implementation.ts, validation.ts (if needed), and any service-specific helpers\n- Move Session, SessionStatus, SessionStatistics, IterationTiming types from src/types/session.types.ts to the service's types.ts\n- Move isSession, isSessionStatus from src/lib/type-guards.ts to the service's validation.ts\n- Implementation uses closure-based caching",
			"steps": [
				"Create src/lib/services/session/types.ts with Session, SessionStatus, SessionStatistics, IterationTiming interfaces, and SessionService interface",
				"Create src/lib/services/session/validation.ts with isSession, isSessionStatus type guards",
				"Create src/lib/services/session/implementation.ts with createSessionService factory function including all session operations (create, load, save, delete, recordIterationStart, recordIterationEnd, updateIteration, updateStatus, isResumable)",
				"Update src/lib/services/container.ts to import SessionService from ./session/types.ts",
				"Update src/lib/services/bootstrap.ts to import createSessionService from ./session/implementation.ts",
				"Update src/lib/services/index.ts to re-export Session, SessionService, SessionStatus types",
				"Update all consumers to use getSessionService() instead of direct imports from src/lib/session.ts",
				"Remove Session types from src/types/session.types.ts and session type guards from src/lib/type-guards.ts",
				"Delete src/lib/session.ts after all consumers are migrated"
			],
			"done": true
		},
		{
			"title": "Migrate ConfigService to new architecture",
			"description": "Migrate the config module to the new self-contained service architecture. ConfigService already exists but needs restructuring.\n\nARCHITECTURE RULES:\n- Services are defined as interfaces in types.ts within each service directory\n- Implementations are factory functions (createXxxService) that return the interface\n- NO index.ts barrel files inside service directories to avoid circular imports\n- Container imports types from ./servicename/types.ts and implementations from ./servicename/implementation.ts\n- Top-level src/lib/services/index.ts is the ONLY barrel file, explicitly listing all exports\n- Each service directory is self-contained with: types.ts, implementation.ts, validation.ts (if needed), and any service-specific helpers\n- Move RalphConfig, AgentType, NotificationConfig, MemoryConfig, VerificationConfig, ConfigValidationError, ConfigValidationResult from src/types/config.types.ts to the service's types.ts\n- Move isRalphConfig, isPartialRalphConfig from src/lib/type-guards.ts to the service's validation.ts\n- Move config constants from src/lib/constants/config.ts to the service's constants.ts",
			"steps": [
				"Create src/lib/services/config/types.ts with RalphConfig, AgentType, NotificationConfig, MemoryConfig, VerificationConfig, ConfigValidationError, ConfigValidationResult interfaces, and ConfigService interface",
				"Create src/lib/services/config/validation.ts with isRalphConfig, isPartialRalphConfig, validateConfig type guards",
				"Create src/lib/services/config/constants.ts with CONFIG_DEFAULTS, DEFAULT_CONFIG, VALID_AGENTS, AGENT_COMMANDS, and default value constants",
				"Create src/lib/services/config/implementation.ts with createConfigService factory function (refactor from existing ConfigServiceImpl)",
				"Update src/lib/services/container.ts to import ConfigService from ./config/types.ts",
				"Update src/lib/services/bootstrap.ts to import createConfigService from ./config/implementation.ts",
				"Update src/lib/services/index.ts to re-export RalphConfig, ConfigService, AgentType types",
				"Update all consumers to use getConfigService() instead of imports from src/lib/config.ts or src/lib/config/index.ts",
				"Remove config types from src/types/config.types.ts and config type guards from src/lib/type-guards.ts",
				"Delete src/lib/config.ts, src/lib/config/ directory, and src/lib/constants/config.ts after migration"
			],
			"done": true
		},
		{
			"title": "Migrate PrdService to new architecture",
			"description": "Migrate the PRD module to the new self-contained service architecture. PrdService already exists but needs restructuring.\n\nARCHITECTURE RULES:\n- Services are defined as interfaces in types.ts within each service directory\n- Implementations are factory functions (createXxxService) that return the interface\n- NO index.ts barrel files inside service directories to avoid circular imports\n- Container imports types from ./servicename/types.ts and implementations from ./servicename/implementation.ts\n- Top-level src/lib/services/index.ts is the ONLY barrel file, explicitly listing all exports\n- Each service directory is self-contained with: types.ts, implementation.ts, validation.ts (if needed), and any service-specific helpers\n- Move Prd, PrdTask, LoadPrdResult, DecompositionSubtask, DecompositionRequest from src/types/prd.types.ts to the service's types.ts\n- Move isPrd, isPrdTask from src/lib/type-guards.ts to the service's validation.ts\n- Include helper functions like getNextTask, getTaskByTitle, canWorkOnTask in the service interface",
			"steps": [
				"Create src/lib/services/prd/types.ts with Prd, PrdTask, LoadPrdResult, DecompositionSubtask, DecompositionRequest, TaskWithIndex, CanWorkResult interfaces, and PrdService interface",
				"Create src/lib/services/prd/validation.ts with isPrd, isPrdTask type guards",
				"Create src/lib/services/prd/implementation.ts with createPrdService factory function including all PRD operations (get, save, reload, invalidate, findFile, isComplete, getNextTask, getNextTaskWithIndex, getTaskByTitle, getTaskByIndex, getCurrentTaskIndex, canWorkOnTask, createEmpty, loadInstructions)",
				"Update src/lib/services/container.ts to import PrdService from ./prd/types.ts",
				"Update src/lib/services/bootstrap.ts to import createPrdService from ./prd/implementation.ts",
				"Update src/lib/services/index.ts to re-export Prd, PrdTask, PrdService types",
				"Update all consumers to use getPrdService() instead of imports from src/lib/prd.ts",
				"Remove PRD types from src/types/prd.types.ts and PRD type guards from src/lib/type-guards.ts",
				"Delete src/lib/prd.ts and src/lib/services/PrdService.ts after migration"
			],
			"done": true
		},
		{
			"title": "Migrate GuardrailsService to new architecture",
			"description": "Migrate the guardrails module to the new self-contained service architecture.\n\nARCHITECTURE RULES:\n- Services are defined as interfaces in types.ts within each service directory\n- Implementations are factory functions (createXxxService) that return the interface\n- NO index.ts barrel files inside service directories to avoid circular imports\n- Container imports types from ./servicename/types.ts and implementations from ./servicename/implementation.ts\n- Top-level src/lib/services/index.ts is the ONLY barrel file, explicitly listing all exports\n- Each service directory is self-contained with: types.ts, implementation.ts, validation.ts (if needed), and any service-specific helpers\n- Move PromptGuardrail, GuardrailTrigger, GuardrailCategory from src/types/config.types.ts to the service's types.ts\n- Move isPromptGuardrail, isGuardrailsFile from src/lib/type-guards.ts to the service's validation.ts\n- Move createDefaultGuardrails from src/lib/constants/defaults.ts to the service's defaults.ts",
			"steps": [
				"Create src/lib/services/guardrails/types.ts with PromptGuardrail, GuardrailTrigger, GuardrailCategory, AddGuardrailOptions, GuardrailsFile interfaces, and GuardrailsService interface",
				"Create src/lib/services/guardrails/validation.ts with isPromptGuardrail, isGuardrailsFile type guards",
				"Create src/lib/services/guardrails/defaults.ts with createDefaultGuardrails function",
				"Create src/lib/services/guardrails/formatters.ts with formatGuardrailsForPrompt function",
				"Create src/lib/services/guardrails/implementation.ts with createGuardrailsService factory function including all guardrails operations (get, save, exists, initialize, invalidate, add, remove, toggle, getById, getActive)",
				"Update src/lib/services/container.ts to import GuardrailsService from ./guardrails/types.ts",
				"Update src/lib/services/bootstrap.ts to import createGuardrailsService from ./guardrails/implementation.ts",
				"Update src/lib/services/index.ts to re-export PromptGuardrail, GuardrailsService types",
				"Update all consumers to use getGuardrailsService() instead of imports from src/lib/guardrails.ts",
				"Remove guardrail types from src/types/config.types.ts and guardrail type guards from src/lib/type-guards.ts",
				"Delete src/lib/guardrails.ts and remove createDefaultGuardrails from src/lib/constants/defaults.ts after migration"
			],
			"done": true
		},
		{
			"title": "Clean up legacy files and types after service migration",
			"description": "Remove all legacy files, empty type definitions, and unused code after all services have been migrated.\n\nARCHITECTURE RULES:\n- Services are defined as interfaces in types.ts within each service directory\n- Implementations are factory functions (createXxxService) that return the interface\n- NO index.ts barrel files inside service directories to avoid circular imports\n- Container imports types from ./servicename/types.ts and implementations from ./servicename/implementation.ts\n- Top-level src/lib/services/index.ts is the ONLY barrel file, explicitly listing all exports\n- src/types/ should only contain cross-cutting types that don't belong to any single service (AppState, ActiveView, CLI types, etc.)\n- src/lib/type-guards.ts should only contain type guards for remaining cross-cutting types",
			"steps": [
				"Review src/types/session.types.ts and remove any types that were migrated to services (keep only IterationLog types if they weren't migrated)",
				"Review src/types/config.types.ts and remove any types that were migrated to services (keep only CheckResult, VerificationResult if they weren't migrated)",
				"Review src/types/prd.types.ts and delete if empty after migration",
				"Review src/lib/type-guards.ts and remove migrated type guards, keep only guards for remaining types",
				"Update src/types/index.ts to only export remaining cross-cutting types",
				"Delete src/lib/config.ts facade file if still exists",
				"Delete src/lib/config/ directory if still exists",
				"Delete src/lib/constants/config.ts if migrated to config service",
				"Update src/lib/constants/index.ts to remove migrated exports",
				"Run TypeScript compiler to verify no broken imports",
				"Run tests to verify all functionality still works"
			],
			"done": true
		}
	]
}
