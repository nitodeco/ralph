---
const installCommand =
  "curl -fsSL https://raw.githubusercontent.com/nitodeco/ralph/main/scripts/install.sh | bash";
---

<div class="w-full max-w-2xl mx-auto">
  <div
    class="bg-[var(--color-bg-elevated)] border border-[var(--color-border)] rounded-lg overflow-hidden"
  >
    <div
      class="flex items-center justify-between px-4 py-2 bg-[var(--color-bg-subtle)] border-b border-[var(--color-border)]"
    >
      <span class="text-sm text-[var(--color-text-muted)]">Install</span>
      <button
        id="copy-button"
        class="flex items-center gap-1 px-2 py-1 text-xs text-[var(--color-text-muted)] hover:text-[var(--color-text)] bg-[var(--color-bg-elevated)] hover:bg-[var(--color-bg)] border border-[var(--color-border)] rounded transition-colors"
        data-command={installCommand}
        aria-label="Copy install command to clipboard"
      >
        <svg
          id="copy-icon"
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
          <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"
          ></path>
        </svg>
        <svg
          id="check-icon"
          class="hidden"
          xmlns="http://www.w3.org/2000/svg"
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        <span id="copy-text">Copy</span>
      </button>
    </div>
    <div class="px-4 py-3 overflow-x-auto">
      <pre
        class="text-sm font-mono text-[var(--color-text)]">{installCommand}</pre>
    </div>
  </div>
</div>

<script>
  function setupCopyButton() {
    const copyButton = document.getElementById("copy-button");
    const copyIcon = document.getElementById("copy-icon");
    const checkIcon = document.getElementById("check-icon");
    const copyText = document.getElementById("copy-text");

    if (!copyButton || !copyIcon || !checkIcon || !copyText) {
      return;
    }

    copyButton.addEventListener("click", async () => {
      const command = copyButton.dataset.command;

      if (!command) {
        return;
      }

      try {
        await navigator.clipboard.writeText(command);
        copyIcon.classList.add("hidden");
        checkIcon.classList.remove("hidden");
        copyText.textContent = "Copied!";

        setTimeout(() => {
          copyIcon.classList.remove("hidden");
          checkIcon.classList.add("hidden");
          copyText.textContent = "Copy";
        }, 2000);
      } catch {
        copyText.textContent = "Failed";
        setTimeout(() => {
          copyText.textContent = "Copy";
        }, 2000);
      }
    });
  }

  setupCopyButton();
  document.addEventListener("astro:page-load", setupCopyButton);
</script>
