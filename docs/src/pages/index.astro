---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Header from "@/components/Header.astro";
import MobileNav from "@/components/MobileNav.astro";
import Footer from "@/components/Footer.astro";
import Button from "@/components/Button.astro";
import Terminal from "@/components/Terminal.astro";
import FeatureCard from "@/components/FeatureCard.astro";
import FeatureIcon from "@/components/FeatureIcon.astro";

const currentPath = Astro.url.pathname;

const terminalLines = [
  '<span class="text-text-subtle">$</span> ralph start',
  '<span class="text-brand">▸</span> Starting session on feature/auth...',
  '<span class="text-brand">▸</span> Task 1/5: Implement login form',
  '<span class="text-emerald-400">✓</span> Task completed',
];

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Ralph",
  "applicationCategory": "DeveloperApplication",
  "operatingSystem": "macOS, Linux",
  "description":
    "CLI tool for long-running PRD-driven development with AI coding agents. Orchestrates iterative agent runs with retries, verification, progress tracking, and GitHub integration.",
  "url": "https://nitodeco.github.io/",
  "author": {
    "@type": "Person",
    "name": "nitodeco",
    "url": "https://github.com/nitodeco",
  },
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD",
  },
  "license": "https://opensource.org/licenses/MIT",
};
---

<BaseLayout
  title="Ralph - PRD-Driven Development with AI"
  description="CLI tool for long-running PRD-driven development with AI coding agents. Orchestrates iterative agent runs with retries, verification, and GitHub integration."
>
  <Header currentPath={currentPath} />
  <MobileNav currentPath={currentPath} />

  <main id="main-content" class="flex flex-1 flex-col">
    <section class="hero-section relative flex flex-col items-center justify-center min-h-[calc(100vh-8rem)] px-4 py-20 sm:py-28 overflow-hidden">
      <div class="hero-gradient" aria-hidden="true"></div>
      <div class="hero-grid" aria-hidden="true"></div>

      <h1 class="hero-title mb-6 relative z-10 flex justify-center">
        <span class="sr-only">Ralph - PRD-Driven Development CLI for AI Coding Agents</span>
        Stop babysitting agents
      </h1>

      <p class="hero-tagline text-lg sm:text-xl text-text-muted mb-12 relative z-10 text-center max-w-md">
        Ralph implements entire projects while you sleep.
      </p>

      <div class="w-full max-w-2xl mx-auto mb-14 relative z-10">
        <Terminal lines={terminalLines} animated />
      </div>

      <div class="flex flex-wrap justify-center gap-3 relative z-10">
        <Button href={`${import.meta.env.BASE_URL}docs`}>Documentation</Button>
        <Button variant="secondary" href="https://github.com/nitodeco/ralph">
          GitHub
        </Button>
      </div>
    </section>

    <section class="features-section relative px-4 py-24 sm:py-32 overflow-hidden">
      <div class="features-grid" aria-hidden="true"></div>
      <div class="max-w-5xl mx-auto relative z-10">
        <div class="text-center mb-20">
          <h2 class="text-2xl sm:text-3xl font-semibold mb-4 tracking-tight">
            Ship features faster with AI that actually finishes the job
          </h2>
          <p class="text-text-muted max-w-lg mx-auto text-base">
            Ralph orchestrates AI coding agents to complete entire features from your requirements—not just one file at a time.
          </p>
        </div>

        <div class="bento-grid grid grid-cols-1 md:grid-cols-3 gap-4">
          <FeatureCard
            title="PRD-Driven Workflow"
            description="Write your requirements once. Ralph works through each task systematically while you focus on other work—no babysitting required."
            variant="featured"
            index={0}
          >
            <FeatureIcon name="document-check" slot="icon" />
          </FeatureCard>

          <FeatureCard
            title="Session Memory"
            description="Ralph learns from each task. If you prefer Zod for validation or Tailwind for styling, it remembers and applies those choices automatically."
            index={1}
          >
            <FeatureIcon name="brain" slot="icon" />
          </FeatureCard>

          <FeatureCard
            title="Long-Running Sessions"
            description="Close your laptop mid-feature. Ralph picks up exactly where it left off—even days later."
            index={2}
          >
            <FeatureIcon name="clock-refresh" slot="icon" />
          </FeatureCard>

          <FeatureCard
            title="Task Decomposition"
            description="Give Ralph a complex feature. It breaks the work into steps and executes them one by one—like a senior developer would."
            index={3}
          >
            <FeatureIcon name="squares-nested" slot="icon" />
          </FeatureCard>

          <FeatureCard
            title="Verification & Retries"
            description="Ralph tests its own work after each task. If tests fail or the build breaks, it fixes the issue and tries again—up to 3 times."
            index={4}
          >
            <FeatureIcon name="check-circle" slot="icon" />
          </FeatureCard>

          <FeatureCard
            title="GitHub Integration"
            description="When a feature is complete, Ralph creates a PR with a detailed description of what changed and why."
            index={5}
          >
            <FeatureIcon name="git-branch" slot="icon" />
          </FeatureCard>
        </div>
      </div>
    </section>

    <section class="pipeline-section relative px-4 py-24 sm:py-32 border-t border-border overflow-hidden">
      <div class="pipeline-grid" aria-hidden="true"></div>
      <div class="max-w-3xl mx-auto relative z-10">
        <div class="text-center mb-16">
          <h2 class="text-2xl sm:text-3xl font-semibold mb-4 tracking-tight">
            How it works
          </h2>
          <p class="text-text-muted max-w-lg mx-auto text-base">
            Three steps from requirements to shipped code.
          </p>
        </div>

        <div class="pipeline-track relative">
          <div class="pipeline-line" aria-hidden="true"></div>

          <div class="pipeline flex flex-col md:flex-row items-stretch justify-between gap-6 md:gap-4 relative z-10">
            <div class="pipeline-step flex-1">
              <div class="pipeline-step-inner h-full p-6 rounded-xl border border-border-subtle bg-bg-elevated">
                <div class="flex items-center gap-3 mb-4">
                  <span class="step-number font-mono text-sm text-brand">01</span>
                  <h3 class="font-mono font-medium text-base">Define</h3>
                </div>
                <p class="text-sm text-text-muted leading-relaxed">Write your PRD with tasks and requirements</p>
              </div>
            </div>

            <div class="pipeline-step flex-1">
              <div class="pipeline-step-inner h-full p-6 rounded-xl border border-border-subtle bg-bg-elevated">
                <div class="flex items-center gap-3 mb-4">
                  <span class="step-number font-mono text-sm text-brand">02</span>
                  <h3 class="font-mono font-medium text-base">Execute</h3>
                </div>
                <p class="text-sm text-text-muted leading-relaxed">Run <code class="text-brand font-mono">ralph start</code> and let it work</p>
              </div>
            </div>

            <div class="pipeline-step flex-1">
              <div class="pipeline-step-inner h-full p-6 rounded-xl border border-border-subtle bg-bg-elevated">
                <div class="flex items-center gap-3 mb-4">
                  <span class="step-number font-mono text-sm text-brand">03</span>
                  <h3 class="font-mono font-medium text-base">Ship</h3>
                </div>
                <p class="text-sm text-text-muted leading-relaxed">Review generated PRs and merge</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="cta-section relative px-4 py-24 sm:py-32 border-t border-border overflow-hidden">
      <div class="cta-grid" aria-hidden="true"></div>
      <div class="max-w-2xl mx-auto text-center relative z-10">
        <h2 class="text-2xl sm:text-3xl font-semibold mb-4 tracking-tight">
          Get started
        </h2>
        <p class="text-text-muted mb-10 text-base">
          Free and open source. Get up and running in under 5 minutes.
        </p>

        <div class="install-block mb-10 mx-auto">
          <div class="install-terminal rounded-lg border border-border-subtle bg-bg-elevated overflow-hidden">
            <div class="install-terminal-header flex items-center gap-2 px-4 py-2.5 border-b border-border-subtle">
              <div class="flex gap-1.5">
                <div class="w-2.5 h-2.5 rounded-full bg-[#ff5f56]/80"></div>
                <div class="w-2.5 h-2.5 rounded-full bg-[#ffbd2e]/80"></div>
                <div class="w-2.5 h-2.5 rounded-full bg-[#27c93f]/80"></div>
              </div>
            </div>
            <div class="install-terminal-body flex items-center gap-3 px-4 py-4 font-mono text-sm">
              <span class="text-text-subtle">$</span>
              <code class="text-text flex-1 text-left overflow-x-auto">curl -fsSL https://raw.githubusercontent.com/nitodeco/ralph/main/scripts/install.sh | bash</code>
              <button
                id="copy-install"
                class="copy-btn shrink-0 p-1.5 rounded text-text-subtle hover:text-text transition-colors"
                aria-label="Copy install command"
              >
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect width="14" height="14" x="8" y="8" rx="2" ry="2" />
                  <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <div class="flex flex-wrap justify-center gap-3">
          <Button href={`${import.meta.env.BASE_URL}docs/getting-started/installation`}>
            Installation guide
          </Button>
          <Button variant="secondary" href={`${import.meta.env.BASE_URL}docs/getting-started/quickstart`}>
            Quickstart
          </Button>
        </div>
      </div>
    </section>
  </main>

  <Footer />

  <script is:inline type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
</BaseLayout>

<script>
  function setupCopyButton() {
    const copyButton = document.getElementById("copy-install");

    if (!copyButton) {
      return;
    }

    copyButton.addEventListener("click", async () => {
      const command = "curl -fsSL https://raw.githubusercontent.com/nitodeco/ralph/main/scripts/install.sh | bash";

      try {
        await navigator.clipboard.writeText(command);
        copyButton.innerHTML = `<svg class="w-4 h-4 text-emerald-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12" /></svg>`;

        setTimeout(() => {
          copyButton.innerHTML = `<svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></svg>`;
        }, 2000);
      } catch {
        // Silently fail
      }
    });
  }

  function setupGridHover() {
    if (!window.matchMedia('(hover: hover)').matches) {
      return;
    }

    const gridConfigs = [
      { sectionSelector: ".hero-section", gridSelector: ".hero-grid", cellSize: 80 },
      { sectionSelector: ".features-section", gridSelector: ".features-grid", cellSize: 64 },
      { sectionSelector: ".pipeline-section", gridSelector: ".pipeline-grid", cellSize: 64 },
      { sectionSelector: ".cta-section", gridSelector: ".cta-grid", cellSize: 64 },
    ];

    gridConfigs.forEach(({ sectionSelector, gridSelector, cellSize }) => {
      const sectionElement = document.querySelector(sectionSelector);
      const gridElement = document.querySelector(gridSelector) as HTMLElement | null;
      
      if (!sectionElement || !gridElement) return;

      const fadeDurationMs = 300;
      const existingOverlays = gridElement.querySelectorAll(".grid-hover-overlay");
      existingOverlays.forEach((overlayElement) => overlayElement.remove());
      
      const existingGlowOverlays = gridElement.querySelectorAll(".grid-glow-overlay");
      existingGlowOverlays.forEach((glowOverlay) => glowOverlay.remove());

      let activeOverlay = null as HTMLDivElement | null;
      let activeCellKey = null as string | null;
      let glowOverlay = null as HTMLDivElement | null;

      const fadeOutOverlay = (overlayElement: HTMLDivElement | null) => {
        if (!overlayElement) return;
        overlayElement.classList.remove("visible");
        window.setTimeout(() => {
          overlayElement.remove();
        }, fadeDurationMs);
      };

      const fadeOutGlowOverlay = () => {
        if (glowOverlay) {
          glowOverlay.classList.remove("visible");
          window.setTimeout(() => {
            glowOverlay?.remove();
            glowOverlay = null;
          }, fadeDurationMs);
        }
      };

      const ensureGlowOverlay = () => {
        if (!glowOverlay) {
          glowOverlay = document.createElement("div");
          glowOverlay.className = "grid-glow-overlay";
          glowOverlay.style.backgroundSize = `${cellSize}px ${cellSize}px`;
          gridElement.appendChild(glowOverlay);
        }
      };

      const handleMouseMove = (event: Event) => {
        const mouseEvent = event as MouseEvent;
        const sectionRect = sectionElement.getBoundingClientRect();
        const gridRect = gridElement.getBoundingClientRect();
        
        const relativeX = mouseEvent.clientX - sectionRect.left;
        const relativeY = mouseEvent.clientY - sectionRect.top;
        
        const gridOffsetX = gridRect.left - sectionRect.left;
        const gridOffsetY = gridRect.top - sectionRect.top;
        
        const gridRelativeX = relativeX - gridOffsetX;
        const gridRelativeY = relativeY - gridOffsetY;

        const cellX = Math.floor(gridRelativeX / cellSize);
        const cellY = Math.floor(gridRelativeY / cellSize);
        const nextCellKey = `${cellX}-${cellY}`;

        if (nextCellKey !== activeCellKey) {
          const overlayX = cellX * cellSize;
          const overlayY = cellY * cellSize;

          fadeOutOverlay(activeOverlay);

          const nextOverlay = document.createElement("div");
          nextOverlay.className = "grid-hover-overlay visible";
          nextOverlay.style.transform = `translate(${overlayX}px, ${overlayY}px)`;
          gridElement.appendChild(nextOverlay);

          activeOverlay = nextOverlay;
          activeCellKey = nextCellKey;
        }

        ensureGlowOverlay();

        if (glowOverlay) {
          gridElement.style.setProperty("--glow-x", `${gridRelativeX}px`);
          gridElement.style.setProperty("--glow-y", `${gridRelativeY}px`);
          glowOverlay.classList.add("visible");
        }
      };

      const handleMouseLeave = () => {
        fadeOutOverlay(activeOverlay);
        activeOverlay = null;
        activeCellKey = null;
        fadeOutGlowOverlay();
      };

      sectionElement.addEventListener("mousemove", handleMouseMove);
      sectionElement.addEventListener("mouseleave", handleMouseLeave);
    });
  }

  setupCopyButton();
  setupGridHover();
  document.addEventListener("astro:page-load", () => {
    setupCopyButton();
    setupGridHover();
  });
</script>

<style>
  .hero-gradient {
    position: absolute;
    inset: 0;
    background: radial-gradient(
      ellipse 80% 50% at 50% -10%,
      rgba(87, 109, 220, 0.08) 0%,
      transparent 50%
    );
    pointer-events: none;
  }

  .hero-grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 80px 80px;
    mask-image: linear-gradient(to bottom, transparent 0%, black 20%, black 50%, transparent 80%);
    -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 20%, black 50%, transparent 80%);
  }

  :global(.grid-hover-overlay) {
    position: absolute;
    width: 80px;
    height: 80px;
    background-color: rgba(255, 255, 255, 0.04);
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease-out;
    z-index: 1;
    top: 0;
    left: 0;
  }

  :global(.grid-hover-overlay.visible) {
    opacity: 1;
  }

  :global(.features-grid .grid-hover-overlay),
  :global(.pipeline-grid .grid-hover-overlay),
  :global(.cta-grid .grid-hover-overlay) {
    width: 64px;
    height: 64px;
    background-color: rgba(255, 255, 255, 0.03);
  }

  :global(.grid-glow-overlay) {
    position: absolute;
    inset: 0;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease-out;
    z-index: 2;
    background-image:
      linear-gradient(to right, rgba(87, 109, 220, 0.12) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(87, 109, 220, 0.12) 1px, transparent 1px);
    filter: drop-shadow(0 0 4px rgba(87, 109, 220, 0.15));
    mask-image: radial-gradient(circle 200px at var(--glow-x, 0px) var(--glow-y, 0px), rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.4) 45%, transparent 75%);
    -webkit-mask-image: radial-gradient(circle 200px at var(--glow-x, 0px) var(--glow-y, 0px), rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.4) 45%, transparent 75%);
  }

  :global(.grid-glow-overlay.visible) {
    opacity: 0.85;
  }

  .hero-title {
    color: var(--color-text);
    text-shadow: 0 0 80px rgba(87, 109, 220, 0.3);
    font-size: 2.5rem;
    font-weight: 700;
    text-align: center;
    line-height: 1.2;
    letter-spacing: -0.025em;
  }

  @media (min-width: 640px) {
    .hero-title {
      font-size: 3rem;
    }
  }

  @media (min-width: 1024px) {
    .hero-title {
      font-size: 3.75rem;
    }
  }

  .hero-tagline {
    animation: fadeIn 0.8s ease-out 0.2s both;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .pipeline-step-inner {
    transition: border-color 0.2s ease, background-color 0.2s ease;
  }

  .pipeline-step:hover .pipeline-step-inner {
    border-color: rgba(87, 109, 220, 0.3);
    background-color: rgba(20, 20, 20, 0.8);
  }

  .step-number {
    opacity: 0.7;
  }

  .features-grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
    background-size: 64px 64px;
    mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%);
  }

  .pipeline-grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
    background-size: 64px 64px;
    mask-image: linear-gradient(to bottom, transparent 0%, black 10%, black 90%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 10%, black 90%, transparent 100%);
  }

  .cta-grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(to right, rgba(255, 255, 255, 0.02) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
    background-size: 64px 64px;
    mask-image: linear-gradient(to bottom, black 0%, black 80%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, black 0%, black 80%, transparent 100%);
  }

  @media (prefers-reduced-motion: reduce) {
    .hero-tagline {
      animation: none;
      opacity: 1;
    }

    :global(.grid-hover-overlay) {
      transition: opacity 0s;
    }

    :global(.grid-glow-overlay) {
      transition: opacity 0s;
    }
  }
</style>
