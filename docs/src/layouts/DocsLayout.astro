---
import BaseLayout from "./BaseLayout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import SidebarNav from "@/components/SidebarNav.astro";
import MobileNav from "@/components/MobileNav.astro";
import Breadcrumbs from "@/components/Breadcrumbs.astro";
import OnThisPage from "@/components/OnThisPage.astro";

interface BreadcrumbItem {
  label: string;
  href?: string;
}

interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  title: string;
  description?: string;
  breadcrumbs?: BreadcrumbItem[];
  headings?: Heading[];
}

const { title, description, breadcrumbs = [], headings = [] } = Astro.props;
const currentPath = Astro.url.pathname;

const breadcrumbJsonLd =
  breadcrumbs.length > 0
    ? {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        itemListElement: breadcrumbs.map((item, index) => ({
          "@type": "ListItem",
          position: index + 1,
          name: item.label,
          ...(item.href && { item: new URL(item.href, Astro.site).toString() }),
        })),
      }
    : null;
---

<BaseLayout title={title} description={description}>
  <Header currentPath={currentPath} />
  <MobileNav currentPath={currentPath} />

  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col lg:flex-row lg:gap-8">
      <aside class="hidden lg:block lg:w-64 lg:flex-shrink-0" aria-label="Documentation navigation">
        <div class="sticky top-20 py-8 overflow-y-auto max-h-[calc(100vh-5rem)]">
          <SidebarNav currentPath={currentPath} />
        </div>
      </aside>

      <main id="main-content" class="min-w-0 flex-1 py-8 lg:py-12">
        {breadcrumbs.length > 0 && <Breadcrumbs items={breadcrumbs} />}
        <article class="prose prose-invert prose-cyan max-w-none" data-pagefind-body>
          <slot />
        </article>
      </main>

      {headings.length > 0 && (
        <aside class="hidden xl:block xl:w-56 xl:flex-shrink-0" aria-label="Table of contents">
          <div class="sticky top-20 py-8">
            <OnThisPage headings={headings} />
          </div>
        </aside>
      )}
    </div>
  </div>

  <Footer />

  {breadcrumbJsonLd && (
    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbJsonLd)} />
  )}
</BaseLayout>
