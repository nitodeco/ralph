---
import BaseLayout from "./BaseLayout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import SidebarNav from "@/components/SidebarNav.astro";
import MobileNav from "@/components/MobileNav.astro";
import Breadcrumbs from "@/components/Breadcrumbs.astro";
import OnThisPage from "@/components/OnThisPage.astro";

interface BreadcrumbItem {
  label: string;
  href?: string;
}

interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  title: string;
  description?: string;
  breadcrumbs?: BreadcrumbItem[];
  headings?: Heading[];
}

const { title, description, breadcrumbs = [], headings = [] } = Astro.props;
const currentPath = Astro.url.pathname;

const breadcrumbJsonLd =
  breadcrumbs.length > 0
    ? {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        itemListElement: breadcrumbs.map((item, index) => ({
          "@type": "ListItem",
          position: index + 1,
          name: item.label,
          ...(item.href && { item: new URL(item.href, Astro.site).toString() }),
        })),
      }
    : null;
---

<BaseLayout title={title} description={description}>
  <Header currentPath={currentPath} />
  <MobileNav currentPath={currentPath} />

  <div class="docs-wrapper relative">
    <div class="docs-grid"></div>
    <div class="docs-bg-gradient"></div>
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 relative">
      <div class="flex flex-col lg:flex-row lg:gap-10">
        <aside class="hidden lg:block lg:w-64 lg:flex-shrink-0" aria-label="Documentation navigation">
          <div class="sticky top-20 py-8 overflow-y-auto max-h-[calc(100vh-5rem)]">
            <SidebarNav currentPath={currentPath} />
          </div>
        </aside>

        <main id="main-content" class="min-w-0 flex-1 py-8 lg:py-12">
          {breadcrumbs.length > 0 && <Breadcrumbs items={breadcrumbs} />}
          <article class="docs-article prose prose-invert prose-cyan max-w-none" data-pagefind-body>
            <slot />
          </article>
        </main>

        {headings.length > 0 && (
          <aside class="hidden xl:block xl:w-56 xl:flex-shrink-0" aria-label="Table of contents">
            <div class="sticky top-20 py-8">
              <OnThisPage headings={headings} />
            </div>
          </aside>
        )}
      </div>
    </div>
  </div>

  <Footer />

  {breadcrumbJsonLd && (
    <script type="application/ld+json" set:html={JSON.stringify(breadcrumbJsonLd)} />
  )}
</BaseLayout>

<style>
  .docs-wrapper {
    min-height: calc(100vh - 3.5rem);
    position: relative;
    overflow: hidden;
  }

  .docs-grid {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 800px;
    background-image:
      linear-gradient(to right, rgba(34, 211, 238, 0.02) 1px, transparent 1px),
      linear-gradient(to bottom, rgba(34, 211, 238, 0.02) 1px, transparent 1px);
    background-size: 48px 48px;
    mask-image:
      linear-gradient(to bottom, black 0%, transparent 100%),
      linear-gradient(to right, transparent 0%, black 20%, black 80%, transparent 100%);
    -webkit-mask-image:
      linear-gradient(to bottom, black 0%, transparent 100%),
      linear-gradient(to right, transparent 0%, black 20%, black 80%, transparent 100%);
    mask-composite: intersect;
    -webkit-mask-composite: source-in;
    pointer-events: none;
  }

  .docs-bg-gradient {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 1200px;
    height: 600px;
    background: radial-gradient(
      ellipse 80% 50% at 50% -20%,
      rgba(34, 211, 238, 0.03) 0%,
      transparent 70%
    );
    pointer-events: none;
  }

  .docs-article {
    opacity: 0;
    animation: fadeInUp 0.4s ease-out forwards;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .docs-article {
      opacity: 1;
      animation: none;
    }
  }
</style>
